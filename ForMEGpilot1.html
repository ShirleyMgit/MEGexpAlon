
<!doctype html>
<html>
  <head>
    <title>My experiment</title
    <style>
    <link rel="stylesheet" type="text/css" href="firstExp9.css">
    </style>
  </head>

   <body>
   <!--required libraries-->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
   <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>

   <!-- tasks part functions-->
   <script src="defineGraphs.js"></script><!--define maps dimentions and missing links-->
   <script src="CreateAr.js"></script><!--create transition matrices arrays-->
   <script src="rectGA.js"></script><!--create rectangular transition matrix-->
   <script src="CreateMissLinkArGen.js"></script><!-- miising links array-->
   <script src="otherFunKeyForMEG.js"></script><!--helper functions-->
   <script src="coverMEG.js"></script><!--learning phase - learn from random walk-->
   <script src="coverPairMEG.js"></script><!--learning from pairs phase-->
   <script src="IsMiddleMEG_missingLink.js"></script><!--is it in the middle task-->
   <script src="selPileNotTwiceMEG.js"></script><!--pile task-->
   <script src="TaskfMRI_MEG.js"></script><!--navigation task-->
   <script src="whereToGoMEG.js"></script><!-- distance estimation task-->
   <script src="saveOrRetMapNewDBnewAJAXMEG.js"></script><!-- save or retrieve maps-->
   <script src="ajaxFunctionsMEG.js"></script >

  <!--start-->

  <!--subject details:-->
   <center><div id="startN" style="background-color: powderblue;">
   <p style="font-size: 20px"><b>Wellcome<br> please enter your details.</p>
  First  Name:<br> <input type="text" id="Fname" value="" ><br><br>
  Last Name:<br> <input type="text" id="Sname" value="" ><br><br>
  <!--when pressing "click when ready to start", call initMapsAndSetDisplay() [] which will look
 for tables for this subject, and if they don't exist, create them.-->
  <button onclick="initMapsAndSetDisplay()" style="background-color:MediumOrchid "><b>Click when ready to start</button>
  <p id = "ms" style="font-size: 20px">The task will start in a few seconds.</p>
  </div> </center>

  <!--task description:-->

  <div class="global inst">
  <p id="inst1"></p>
   <button type="button" id="startTb"
   onclick="choosePart()">Start Task</button>
  </div>


   <!-- cover: phase learning task-->

   <div id="cover">

   <center><div><p class="centerC" id="instructions"> </p>
   <img id="chPicCold"><img id="chPicC1"></div></center>

   <center>
   <div style="padding-bottom: 4%;"class="pic" id="pic1";>
   </div></center>

   <center><p id = "newM"></p></center>

   <button type="button" id = "qBot"
   onclick="endAllTrials(1)">Next Part</button>
   </div>

   <!--Pair cover: learning from pairs-->

   <div id="Pair_cover">

   <center><div><p class="centerP" id="instructionsP"> </p>
   <img id="PicPC1"><img id="PicPC2"></div></center>

   <center><div><p id="conCP">...</p></center>
   <center>
   <div style="padding-bottom: 8%;"class="pic" id="pic1";>
   </div></center>

   <center><p id = "newMP"></p></center>

  </div>


   <!--pile task-->

   <div class="pile">
   <p id="pileIns">The following card will appear in one of the 2 piles,<br> it can appear in the pile if it is associated to the last card that appears on the pile. <br>A card cannot appear twice on the same pile.<br> Can the card appear on the first or second pile? (click 1, 2 or 3 for both)</p>
   <img id="wCp" style="position:relative; bottom:50px;  left:685px;">
   <center><div><p id="isCorRSp" style="position:relative; bottom:60px; left:200px;"></p><p id="EconSp" style="position:relative; bottom:40px; left:70px; font-size:14px;">press ENTER to continoue</p></div></center>
   <center><div id="allPic" style="display:block; position:relative; bottom:40px;">
   <div id="pile1" style="display:block">
   <img id="imCp11"><p></p>
   <img id="imCp12" style="position:relative; bottom:40px; left:20px;"><p></p>
   <img id="imCp13" style="position:relative; bottom:80px; left:40px;"><p></p>
   <img id="imCp14" style="position:relative; bottom:120px; left:60px;"><p></p>
   </div>
   <div id="pile2" style="display:block; position:relative; bottom:530px; left:200px;">
   <img id="imCp21"><p></p>
   <img id="imCp22" style="position:relative; bottom:40px; left:20px;"><p></p>
   <img id="imCp23" style="position:relative; bottom:80px; left:40px;"><p></p>
   <img id="imCp24" style="position:relative; bottom:120px; left:60px;"><p></p>
   </div>
   </div></center>
   <!--<p id="EconSp" style="position:absolute; bottom:200px; left:200px;" >press <b>Enter<b> to continoue</p>-->
   <button type="button" id="nextSp" onclick="writeRresSp()">Next Step</button>
   </div>

   <!--is middle task-->
    <div class="isMiddle">
   <center><p style="font-size: 22px">Can the card in the middle appear between the following first and third cards?</br> A card can appear in the middle only if it is associated to the 2 cards<br> Whether the first and third cards are associated to one another or not is not important. <br> <b>press y/n</p></center>
   <center><div id="im1d"><p>third card</p><img id="im1"></div>
   <div id="im2d"><p>first card</p><img id="im2"></div></center>
   <center><p id="im3cor" style="font-size: 18px; color:red"></p></center>
   <center><p id="im3con">Press <b>Enter</b> to continoue</p></center>
   <center><div id="im3d"><p id="im3p"><br>Intermediate Card?</p><img id="im3"></div></center>

   <button type="button" id="nextIsM" ;
   onclick="writeResp()">Next Step</button>
   </div>

   <!-- Navigation Task:-->

  <div class="task">

  <!--  define instructions block -->
   <p class="centerC" id="instructionsT"> </p><p id="instructionsT2"> </p>

   <center><p id="dispPc">press ENTER to continue</button></br></center>
   <center><p id="skip">press ENTER to skip</p></center>
   <center><div id="tarPid"><p id="targetPic"></p><img id="tarPt"></div></center>
   <center><div id="cPic"><p id="startPic"></p><img id="currPt"></div></center>
   <center><div id="picT">

    <img id="chPic1"/></br>
   <img id="chPic2"/>

   </div> </center>


   <center> <div class="endTask"><p id="endExpReachT"></p>
   <button type="button" id = "conBot"
   onclick="contT(1)">
   click here to continoue for next session</button>
   <button type="button" id = "endBot"
   onclick="endAllTrialsT(1)">
   click to Finish</button>
   </div></center>


   </div>
   <!--the coins-->
   <canvas id="myCanvas" width="450" height="450" >
   </canvas>
   <p id="nCoinP" style="position:fixed; bottom:10px; right:180px;color:blue"></p>

   <center><p id="endThanksT"></p></center>
    <div id="LbotT" ></div> <div id="RbotT"></div>

  <!-- Where to Go: distnce estimation task-->

  <div class="Question">

  <!--  define instructions block -->
   <p class="centerC" id="instructionsQ"> </p>

   <center><div id="tarPidQ"><p id="targetPicQ"></p><img id="tarPQ"></div></center>

   <center><div id="im1Q"><p>CARD 1</p><img id="Q1"></div>
   <div id="im2Q"><p>CARD 2</p><img id="Q2"></div></center>

   <center><p id="iqcor" style="font-size: 20px; color:red"></p></center>
   <center><p id="iqcon">Press <b>Enter</b> to continoue</p></center>

   </div>

   <center><div class="Question_feedback">
   <p id="Qfeedback"></p>
   <button type="button" id="nextBlock"
   onclick="chooseCover(0)">Continue</button>
   </div></center>

<script>
/* the task is orgenized such that there are 8 learning trials of 2 maps and 7 inference trials of a third map*/
iniRun();
/* variable to change */
var isNestDis=0;//disable the next button if equal 1
/*training structural form*/
var typeAr="recA";//"HexA";//"clA";//
/*vriables that are specific to the adjacency matrix:*/
/* graph dimensions are defined in the function createCoverStaff below*/
var nRow;
var nCol;
var nb;//number of neighbours
var np;// the number of pictures
var maxMap = 3;// number of maps
var curMpV = [0,0,0,0,1,1,1,1,2,2,2,2,2,2,2];//defines the map of each block, 0&1 training, 2 - inference
var npmax=36;// maximal number of pictures in an array (map)
var vnmis; // mising links nodes
var vConmis;// the nodes that are connected to the nodes of the missing links nodes

var nT0 = 7;
var nT1 = 15;
var curMp = -1;// current map
var maxdS = 4;
var qend = 24;//20;//45;//34 - mis, 11 regular. number of distance estimation questions
var ncycle = 4;//number of cycles per set
/* parameters for cluster Arch fixed neighbors*/
var nc = 5;// number of clusters in the community structure graph
var ninc = 7;// number of nodes in each cluster
var Ar,DistM,ArMiss;// transition matrix and distance estimation
var flagNR1 = 1;//number of cycle of 2 maps - 2 cycle per map
var flagNR2 = 1;//number of cycle of 2 maps - 2 cycle per map
var NumRep=2;
var maxRoundH = 4;
var maxRoundC = 5;
var maxTask = 200;// maximum number of steps in the distance estimation task
var maxT = curMpV.length;//NumRep*maxRound*maxMap +maxRound*maxMap/2;
var nRepTask = 3;
var numdS=3;
var dsMin = 2;
var numCorrect;//number of correct responses in distance estimation questions
/*max displays during the learning phase in each block*/
var maxCovH = 120;// hex or rectungular
var maxCovC = 180;// cluster
var maxCovP = 150;// learning from pairs
var maxIsM=15;//10;
var maxPile = 15;

var pileAr;
var dS;//the initial distance in the navigation task
/*File Name*/
var writeFile;
var payFile;
var mapFile;
var presntFile;
/*general parameters*/
var sz = 20;//cycle size
var flagC=0,y = 425,dy=0.9*sz;//cirlce height
var x = -5,dx=sz*2+5;
var y0 = y;//intial hight for the cycles
var maxCoin = 140;//maximum number of coins that can be earn in each part
var minTr = 0;//minimum trial to activate the "next" button
var ncoin=0;
var nSD = 2;//number of trials in which distance is given
var nall=50;//number of pictures in the directory;
var nstruct = 2;//number of different map with the same structure
var nnT;//which structure should be used
var maxTrialMap=5;//maximum trial with the same map
var twait=500;
var stType;
var ncolCrc=1;
var cgetR = 0.4;
var thisTC=-1;
/*all display elements*/
var isNmap = document.getElementById("newM");
var isNmapP = document.getElementById("newMP");
var ncoinPv=document.getElementById("nCoinP");
var TheCanvas = document.getElementById("myCanvas");
var div1pair = document.getElementById("1inp");
var EcSp = document.getElementById("EconSp");
var isCsP = document.getElementById("isCorRSp");
var imCsP11= document.getElementById("imCp11");
var imCsP21= document.getElementById("imCp21");
var imCsP12= document.getElementById("imCp12");
var imCsP22= document.getElementById("imCp22");
var imCsP13= document.getElementById("imCp13");
var imCsP23= document.getElementById("imCp23");
var imCsP14= document.getElementById("imCp14");
var imCsP24= document.getElementById("imCp24");
var wCsP12= document.getElementById("wCp");
var pileIn= document.getElementById("pileIns");
var PileDiv = document.getElementsByClassName("pile");
var allPicEl = document.getElementById("allPic");
var isitD = document.getElementById("isThis");
var Ecn = document.getElementById("Econ");
var isMc = document.getElementsByClassName("isMiddle");
var m1 = document.getElementById("im1");
var m2 = document.getElementById("im2");
var m3 = document.getElementById("im3");
var m3p = document.getElementById("im3p");
var m3div = document.getElementById("im3d");
var m3cor= document.getElementById("im3cor");
var m3con= document.getElementById("im3con");
var NmB = document.getElementById("Nm");
var YmB = document.getElementById("Ym");
var crE = document.getElementById("myCanvas");
var allCOVER=document.getElementById("cover");
var allCOVERpair=document.getElementById("Pair_cover");
var instP=document.getElementById("instructionsP");
var imC1= document.getElementById("PicPC1");
var imC2= document.getElementById("PicPC2");
var contCP= document.getElementById("conCP");
var startDiv=document.getElementById("startN");
var picC=document.getElementById("pic1");
var allTask=document.getElementsByClassName("task");
var stB = document.getElementById("startTb");
var gInst=document.getElementsByClassName("global inst");
var endTresult=document.getElementById("endTid");
var endC=document.getElementById("endCover");
var inst=document.getElementById("instructions");
var instB=document.getElementById("instructionsB");
var wellel=document.getElementById("wellc");
var imC = document.getElementById("chPicC1");
var imCold = document.getElementById("chPicCold");
var cPC = document.getElementById("cPic");
var cPCR = document.getElementById("cPicR");
var sPC = document.getElementById("startPic");
var sPCr = document.getElementById("startPicR");
var imCu = document.getElementById("currPt");
var imCuR = document.getElementById("currPtR");
var sPcB=document.getElementById("dispPc");
var sPcBR=document.getElementById("dispPcRW");
var ins1=document.getElementById("inst1");
var imel = document.getElementById("chPic2");
var imel1 = document.getElementById("chPic1");
var imR2 = document.getElementById("chPicR2");
var imR1 = document.getElementById("chPicR1");
var imelt = document.getElementById("tarPt");
var PICclass=document.getElementById("picT");
var trp=document.getElementById("tarPid");
var RBt=document.getElementById("RbotT");
var LBt=document.getElementById("LbotT");
var RBtR=document.getElementById("RbotTR");
var LBtR=document.getElementById("LbotTR");
var Et=document.getElementsByClassName("endTask");
var instT=document.getElementById("instructionsT");
var instTR=document.getElementById("instructionsTR");
var tarPel=document.getElementById("targetPic");
var endErT=document.getElementById("endExpReachT");
var skT=document.getElementById("skip");
var skTR=document.getElementById("skipR");
var nxSp=document.getElementById("nextSp");
var nxIsM = document.getElementById("nextIsM");
var bc=document.getElementById("conBot");
var be=document.getElementById("endBot");
var q1 = document.getElementById("Q1");
var q2 = document.getElementById("Q2");
var instQ=document.getElementById("instructionsQ");
var imelQ = document.getElementById("tarPQ");
var tarPelQ=document.getElementById("targetPicQ");
var allQ=document.getElementsByClassName("Question");
var QFclass =document.getElementsByClassName("Question_feedback");
var feedbackQ=document.getElementById("Qfeedback");
var qcor= document.getElementById("iqcor");
var qcon= document.getElementById("iqcon");

/*disable the end bottuns*/
var qb=document.getElementById("qBot");
/* pictures button objects*/
var RB=document.getElementById("Rbot");
var LB=document.getElementById("Lbot");

var FileName;

/*respone ojsect*/
var resCArr=[];//the array of resCover
var resTArr=[];//the array of resTASK
var resIsMArr=[];//the array of IsItMiddle Task
var resSpArr=[];//the array of which pile Task

/*trial variable*/
var isFround = 1;
var nTrialtM=0;
var nTrialRM=0;
var nTrial12=0;
var nTrialc = 0;
var nTrialt = 0;
var nTrialtr= 0;
var nTrialSp= 0;
var numQ = 0;
var flagSp=2;
var flagMV=5;
var flagSs=-1;
var flagIsM = 9;
var flagCov = 0;
var flagCovP = 0;
var flagQ=-1;
var timeLast,timeLast_sec,timeLast_min,timeLast_hr;//to track response time
var endR=0;
var c,cend,flagSs,corR=0;
var inP1,inP,inPr;
var dtT;
var stTarr;
var flip =0;
var myPic=[]; // the pictures from directory array

/*disable the end bottuns*/
bc.disabled=true;
be.disabled=true;
/*disable the next bottuns*/
 if (isNestDis==1){
   qb.disabled=true;
   skTR.disabled=true;
   nxIsM.disabled=true;
   nxSp.disabled=true;
}
/*trial variable*/
var totalStep = 0;
var in1R,in1L,inP,tar1,nSt,rowT,colT;

/*make display elements unseen*/
cPC.style.display="none";
trp.style.display="none";
allQ[0].style.display="none";
allTask[0].style.display="none";
gInst[0].style.display="none";
allCOVER.style.display="none";
allCOVERpair.style.display="none";
isMc[0].style.display="none";
PileDiv[0].style.display="none";
QFclass[0].style.display="none";
feedbackQ.style.display="none";

var ndis = 1;
var fname;
var sname;
var FullName;
var Pname;
/*array pictures objects - maps*/
var nmap=1;

function initMapsAndSetDisplay(){ // the first function to be called, formerly called starDisc()
/* subject first name*/
   var fname0 = document.getElementById("Fname").value;
   var lenf = fname0.length;
   var j;
   if(fname0.endsWith("\n")||fname0.endsWith(" ")){
      fname = fname0.slice(0,lenf-1);
   }else{
        fname = fname0;
   }
   /*subject second day*/
   var sname0 = document.getElementById("Sname").value;
   var lens = sname0.length;
   if(sname0.endsWith("\n")||sname0.endsWith(" ")){
      sname = sname0.slice(0,lens-1);;
   }else{
    sname = sname0;
   }
   FullName = fname+"_"+sname;
   Pname = fname+"_"+sname; // participant's name

  /*create/retrive MAPS and save in sql table*/
   var TableName = "picturesNumberMEG";
   var j1,j2,j3;
   var ArName;
   var ArName0 = "pic";
   var nmmax,jn;
   nmmax = maxMap;
   var nn,vn=[]; // vn: vector of numbers
   var vn01=[];
   var vn1=[];
   for (j3=1;j3<=nall;j3++){
     vn01.push(j3);
   }

   nn = nall;// nall is the number of pictures in the directory

    for (j3=0;j3<=npmax;j3++){ // npmax is the length of the largest map of the experiment
       np0 = Math.floor(Math.random() * (nn));
	   vn1.push(vn01[np0]);
	   vn01.splice(np0, 1);
	   nn = nn-1;
    }
 
  	nn = npmax;
    // check if the pictures array already exists. If it does, return it in an array (the emission matrix - we need one for all maps).
    // If it doesn't, return -1
  	myPic = checkExists(fname,sname);
  	if (myPic[0]==-1){ //map does not exists
  		myPic=[];
  		for (j1=0; j1<npmax;j1++){
  			myPic.push(vn1[j1]);
  			nn = nn-1;
  			jn = j1+1;
  			ArName = ArName0+jn;
  			saveDataDB(Pname,vn1[j1],ArName,TableName);
  			vn.splice(np0, 1);
  		}
  	}
  	if (vn.length>0){
  		clear1dArr(vn);
  	}
   

   /* change display */
   startDiv.style.display="none";
   gInst[0].style.display="inline";
   stB.style.display="inline";
   Et[0].style.display="none";
   PICclass.style.display="inline";
   /* general instructions - the instructions that appears at the start page*/
   ins1.innerHTML="<b>Task description<b>:<br> We are playing a card memory game. Each picture is a card. <br> The task is divided into rounds, on each rounds there are 5 parts. <br> Today you will learn two pictures sets. <br> The first part is a learning phase. If the pictures are from a new set of pictures, a red message will appear on the screen. <br> If the pictures belong to the same pictures sets as in the previouse round of games there will be a green message. <br> In each step you can lose/win coins. In some of the games you can see the coins you got on the right side of the screen.<br>Follow the instruction on each part of the game.";//<br>During the first part you will have to determine whether the picture is tilt or not,<br>pay attention to the pictures on the cards and the order in which they are presented, as it will help you in the following  tasks.";
   document.getElementById("targetPic").innerHTML="your target is:<br> ";

   //presPic();// for debugging, present all images
}

function presPic(){
  /*display the pictures array -  for debugging*/
var disPic = 0;
var j,picSrc,isLine,leftP,leftP0,rightP=0;
var FileName = "/home/smark/web/set1reg/";
var imH = 120;
var dpL = 20;
var dpR = 20;
	leftP0 = Math.ceil(nCol/2)*imH;
	leftP = leftP0;
	document.write("<div class='dispPicArr'>");
	for(j=0;j<npmax;j++){
		picSrc = FileName+"pic"+ myPic[j].toString() + ".jpg'";
		document.write("<img border ='5px solid gray' height='"+imH+"'px width='"+imH+"px' position='relative' left="+leftP+"px right="+rightP+"px src='"+picSrc+">");
		isLine = Math.ceil((j+1)/nCol);
		isLine = (isLine)*nCol-j-1;
		leftP = leftP+dpL;
		if(isLine==0){
			document.write("<br>");
			leftP = leftP0;
			rightP = 0;
		}
	}

}



function choosePart(){// find the task's part in which particpants played with before he took the break
  //find trial number and task part:
  var n;
   var nTrialcV=[];
   var nTrialcVs=[];
   nTrialcV[0] = TrialNum("coverTable",FullName); // function TrialNum is in ajaxFunctionsMEG.js, TrialNum gives the current trial in each task
   nTrialcV[1] = TrialNum("isMiddleTable",FullName);
   nTrialcV[2] = TrialNum("isPileTable",FullName);
   nTrialcV[3] = TrialNum("TaskTable",FullName);
   nTrialcV[4] = TrialNum("qTable",FullName);
   for(n=0;n<nTrialcV.length;n++){
		nTrialcVs[n]=nTrialcV[n];
		if(n<nTrialcV.length-1){
			nTrialcVs.push([]);
			}
   }
   var maxTc = maxArr(nTrialcVs);
   /* change display*/
   isMc[0].style.display="none";
   allTask[0].style.display="none";
   gInst[0].style.display="none";
   ncoinT = 0;
   if(nTrialcV[0]==0){// learning phase
		nTrialc  = 1;
		coverTask(0);
   }else{
        nTrialc = maxTc;
		curMp = curMpV[nTrialc-1];
   		if (nTrialc>1){
				curMpLast = curMpV[nTrialc-2];
		}else{
				curMpLast = -1;
		}
		if(nTrialcV[4]==maxTc){
			numQ = inThisT("qTable",FullName);//read the number of questions that was asked in the current block from the table of the distance estimation task - from sql
			ncoin=numCoin("qTable",FullName);// check the number of coines that was earned until now
			if (numQ<qend){// continue distance estimation task
				numCorrect = calCorQ("qTable",FullName);// number of correct answers
				createCoverStaff();
				startQuestion(numQ);
				}else{// start learning phase of the next block
					nTrialc = nTrialc+1;
					if(nTrialc>8){// 8 learning trials on day 1, then start inference part
						coverPairTask(0);// learning from pairs
					}else{
						coverTask(0);// learning from random walk
					}
				}
		}else{

			if (nTrialcV[3]==maxTc){
				createCoverStaff();
			    if(nTrialc<9){
					cds = TaskdS(FullName);
					if (cds == maxdS){// start distance estimation questions
					//curMp = curMpV[nTrialc-1];
					//createCoverStaff();
					numQ=0;
					startQuestion(numQ);
					}else{// continue with navigation task
						//curMp = curMpV[nTrialc-1];
						ncoin=numCoin("TaskTable",FullName);
						//createCoverStaff();
						var ntn = inThisT("TaskTable",FullName);
						repTmis = Math.floor(ntn/numdS);
						startTask(cds+1);
					}
				}else{
					startQuestion(0);
				}
			}else{
				if(nTrialcV[1]==maxTc){// go to is it in the middle part
					nrep=inThisT("isMiddleTable",FullName);
					ncoin=numCoin("isMiddleTable",FullName);
					createCoverStaff();
					if(nrep<maxIsM){
						isItMiddle(0);
					}else{
					if(nTrialc<9){
						startTask(2);
					}else{
						startQuestion(0);
					}
					}

				}else{
					if(nTrialcV[2]==maxTc){// go to which pile part
						thisT = inThisT("isPileTable",FullName);// read the number of trials that the subject have allready played in this block from the sql table
						ncoin=numCoin("isPileTable",FullName);
						createCoverStaff();
						if(thisT<maxPile){
							whichPile(0);
						}else{
							isItMiddle(1);
						}
					}else{// continue phase learning task
						ncoin=numCoin("TaskTable",FullName);
						if (maxTc>8){
							thisTC = inThisT("coverPairTable",FullName);
							coverPairTask(thisTC);// learning from pairs
						}else{
						    thisTC = inThisT("coverTable",FullName);
							coverTask(thisTC);//learning from random walk
							}
					}
				}
			}
		}
	}

}
function chooseCover(){
	if (nTrialc>8){
		coverPairTask(0);
	}else{
		coverTask(0);
}
}


function creatMissArHexPair(Ar){
vnmis=[1,2,8,9,13,14,19,20,26,27,31,32];//[2,3,8,9,13,14,20,21,26,27,32,33];
lnmis  = vnmis.length;
vConmis = [[2,32],[1],[9,13],[8],[8,14],[13,19],[14,20],[19],[27,31],[26],[26,32],[31,1]];//[[3,33],[2],[9,13],[8],[8,14],[13,20],[14,21],[20],[27,32],[26],[33,26],[2,32]];
tran24 = [[1,27],[31,27],[0,32],[31,33],[19,9],[13,9],[18,14],[13,15]];//[[2,22],[32,27],[1,33],[32,34],[20,9],[13,15],[13,9],[19,14]];
tran34 = [[22,31],[30,2],[3,31],[30,27],[18,15],[16,19],[10,19],[7,15]];//[[31,3],[1,33],[4,32],[21,27],[19,15],[16,20],[10,20],[15,7]];
tran13 = [[1,32],[31,32],[14,19],[13,14]];//[[2,33],[32,33],[14,20],[13,14]];
tran23 = [[31,2],[1,33],[26,1],[25,27],[0,2],[1,3],[31,21],[13,20],[19,15],[8,19],[8,10],[18,20],[19,21],[13,3]];//[[32,3],[2,34],[26,2],[25,27],[1,3],[2,4],[21,32],[27,20],[15,20],[13,21],[8,20],[2,13],[3,8],[19,21],[19,8]];
var s=0,nnb,b,a,c,s,k,flag,flag2;
var Armiss=[[]];
for(a=0;a<np;a++){
flag =0;
   for(c=s;c<vnmis.length;c++){
		if(a==vnmis[c]){
			flag = 1;
			s = c;
			break;
		}
   }
   if (flag==0){
   		nnb = nb;
		Armiss[a].push( new Array(nnb));
		for (j=0;j<nb;j++){
			Armiss[a][j] = Ar[a][j];
		}
   }else{
        nnb = nb-vConmis[c].length;
		Armiss[a].push( new Array(nnb));
		b=0;
		//flag2 = 0;
		for (j=0;j<nb;j++){
		flag2 = 0;
		    for(k=0;k<vConmis[c].length;k++){
				if (Ar[a][j]==vConmis[c][k]){
				flag2 = 1;
				}
			}
			if (flag2==0){
				Armiss[a][b] = Ar[a][j];
				b = b+1;
			}
		}

   }
   if(a<np-1){
		Armiss.push([]);
	}
}
return Armiss;
}



function creat2MissLinkAr(Ar){
	var missNN = [14,30];
	 misPileA = [[5,0,31,30],[20,21,15,14],[30,29,35,5],[14,8,13,20],[0,30,24,19],[21,14,9,3]];
	 var j,nnb,b;
	 var MISSnnV = [20,13,5,35];
	 var lenMsV = MISSnnV.length;
	 var Armiss=[[]];
	 for(a=0;a<np;a++){
	   flag = -1;
	   if (a==missNN[0]){
	     flag = missNN[0];
		}else{
			if (a==missNN[1]){
				flag = missNN[1];
			}else{
			   for(j=0;j<lenMsV;j++){
					if(a==MISSnnV[j]){
						flag = MISSnnV[j];
					}
			   }
			}
		}
		if(flag==-1){
			nnb = nb;
			Armiss[a].push( new Array(nnb));
			for (j=0;j<nb;j++){
				Armiss[a][j] = Ar[a][j];
			}
		}else{
			if(flag!= missNN[0]&&flag!= missNN[1]){
				nnb = nb-1;
				Armiss[a].push( new Array(nnb));
				b = 0;
				for (j=0;j<nb;j++){
					if (Ar[a][j]!=missNN[0]&&Ar[a][j]!= missNN[1]){
						Armiss[a][b] = Ar[a][j];
						b = b+1;
					}
				}
			}else{
				nnb = 4;
				Armiss[a].push( new Array(nnb));
				b=0;
				if(a==missNN[0]){
					for (j=0;j<nb;j++){
						if (Ar[a][j]!=MISSnnV[0]&&Ar[a][j]!= MISSnnV[1]){
							Armiss[a][b] = Ar[a][j];
							b = b+1;
						}
					}
				}else{
					for (j=0;j<nb;j++){
						if (Ar[a][j]!=MISSnnV[3]&&Ar[a][j]!= MISSnnV[2]){
							Armiss[a][b] = Ar[a][j];
							b = b+1;
						}
					}
				}
			}
		}

	   if(a<np-1){
		  Armiss.push([]);
		 }
	   }//first for
	  return Armiss;
}
function creatMissArCluster(Ar){
	var a,j,b;
	var nMiss = (nc-1)*ninc;
	var ArmissC=[[]];
	for(a=0;a<nMiss;a++){
		if (a==0){
			b=0;
			ArmissC[a].push( new Array(nb-1));
			for(j=0;j<nb-1;j++){
				if (Ar[a][j]<nMiss){
					ArmissC[a][b]=	Ar[a][j];
					b=b+1;
				}
			}
		}else{
			if(a<nMiss-1){
				ArmissC[a].push( new Array(nb));
				for(j=0;j<nb;j++){
					ArmissC[a][j]=	Ar[a][j];
				}
				}else{
					ArmissC[a].push( new Array(nb-1));
					var ab=0;
					for(j=0;j<nb;j++){
						if(Ar[a][j]!=nMiss){
							ArmissC[a][ab]=	Ar[a][j];
							ab=ab+1;
						}
					}
				}
		}
		if(a<nMiss-1){
			ArmissC.push([]);
			}
	}
	return ArmissC;
}

function creatMissArCluster2(Ar){
	var a,j,b;
	var nMiss = (nc-1)*ninc;
	var ArmissC=[[]];
	for(a=0;a<nMiss;a++){
		if (a==0){
			b=0;
			ArmissC[a].push( new Array(nb-1));
			for(j=0;j<nb-1;j++){
				if (Ar[a][j]<nMiss){
					ArmissC[a][b]=	Ar[a][j];
					b=b+1;
				}
			}
		}else{
			if(a<nMiss-1){
				ArmissC[a].push( new Array(nb));
				for(j=0;j<nb;j++){
					ArmissC[a][j]=	Ar[a][j];
				}
				}else{
					ArmissC[a].push( new Array(nb-1));
					var ab=0;
					for(j=0;j<nb;j++){
						if(Ar[a][j]!=nMiss){
							ArmissC[a][ab]=	Ar[a][j];
							ab=ab+1;
						}
					}
				}
		}

		ArmissC.push([]);

	}

	for(a=nMiss;a<nc*ninc;a++){
		if (a==nMiss){
			b=0;
			ArmissC[a].push( new Array(nb-1));
			for(j=0;j<nb-1;j++){
				if (Ar[a][j]>=nMiss){
					ArmissC[a][b]=	Ar[a][j];
					b=b+1;
				}
			}
		}else{
			if(a<nc*ninc-1){
				ArmissC[a].push( new Array(nb));
				for(j=0;j<nb;j++){
					ArmissC[a][j]=	Ar[a][j];
				}
				}else{
					ArmissC[a].push( new Array(nb-1));
					var ab=0;
					for(j=0;j<nb;j++){
						if(Ar[a][j]>=nMiss){//!=0){
							ArmissC[a][ab]=	Ar[a][j];
							ab=ab+1;
						}
					}
				}
		}
		if(a<nc*ninc-1){
			ArmissC.push([]);
			}
	}

	return ArmissC;
}
</script>


</body>
</html>
